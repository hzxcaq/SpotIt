# 物品图片上传功能 - 验收清单

## 📋 功能验收标准

### 1. 图片上传功能

#### 1.1 基础上传
- [ ] **相册选择**
  - 点击"上传图片"按钮
  - 选择相册中的图片
  - 图片成功上传并显示

- [ ] **相机拍照**（移动端）
  - 点击"上传图片"按钮
  - 选择"拍照"选项
  - 拍摄照片后自动上传

- [ ] **上传进度**
  - 上传时显示加载动画
  - 按钮显示"上传中..."文字
  - 上传完成后恢复正常状态

#### 1.2 图片处理
- [ ] **自动压缩**
  - 上传 5MB 图片 → 压缩到 ≤500KB
  - 上传 10MB 图片 → 压缩到 ≤500KB
  - 压缩后图片清晰可见

- [ ] **尺寸调整**
  - 上传 4K 图片 → 最长边调整到 ≤1280px
  - 上传 8K 图片 → 最长边调整到 ≤1280px
  - 保持原始宽高比

- [ ] **格式转换**
  - 上传 PNG → 转换为 JPEG
  - 上传 WebP → 转换为 JPEG
  - 上传 JPEG → 保持 JPEG

#### 1.3 错误处理
- [ ] **文件大小限制**
  - 上传 >10MB 文件 → 显示"文件不能超过 10MB"
  - 错误提示显示在图片区域下方
  - 错误提示为红色文字

- [ ] **文件格式限制**
  - 上传 .txt 文件 → 显示"仅支持图片格式"
  - 上传 .pdf 文件 → 显示"仅支持图片格式"
  - 上传 .mp4 文件 → 显示"仅支持图片格式"

- [ ] **网络错误**
  - 断网情况下上传 → 显示"上传失败，请重试"
  - 错误提示清晰明确

---

### 2. 图片显示功能

#### 2.1 详情页显示
- [ ] **有图片时**
  - 图片显示为方形容器（1:1 比例）
  - 图片居中显示，使用 object-cover
  - 图片清晰，无明显失真
  - 鼠标悬停时显示半透明效果

- [ ] **无图片时**
  - 显示虚线边框占位符
  - 显示图标和"暂无图片"文字
  - 显示"上传图片"按钮
  - 占位符高度合理

#### 2.2 列表页缩略图
- [ ] **有图片时**
  - 显示 48px 方形缩略图
  - 缩略图清晰可见
  - 圆角边框（rounded-lg）
  - 背景色为 muted

- [ ] **无图片时**
  - 显示默认 Tag 图标
  - 图标大小为 20px
  - 图标颜色与主题一致

#### 2.3 全屏查看器
- [ ] **打开查看器**
  - 点击详情页图片 → 打开全屏查看器
  - 查看器背景为黑色半透明
  - 图片居中显示
  - 图片完整可见（不裁剪）

- [ ] **关闭查看器**
  - 点击关闭按钮 → 查看器关闭
  - 点击背景区域 → 查看器关闭
  - 按 ESC 键 → 查看器关闭（如果支持）

- [ ] **无障碍支持**
  - 关闭按钮有 aria-label
  - 屏幕阅读器可识别

---

### 3. 图片管理功能

#### 3.1 替换图片
- [ ] **操作流程**
  - 点击右上角"上传"图标
  - 选择新图片
  - 旧图片被替换
  - 新图片正确显示

- [ ] **数据一致性**
  - 旧图片从 IndexedDB 删除
  - 新图片保存到 IndexedDB
  - Item.imageId 正确更新

#### 3.2 删除图片
- [ ] **操作流程**
  - 点击右上角"删除"图标
  - 图片立即删除
  - 显示"暂无图片"占位符

- [ ] **数据一致性**
  - 图片从 IndexedDB 删除
  - Item.imageId 设置为 undefined
  - 列表页缩略图更新为默认图标

---

### 4. 数据持久化

#### 4.1 本地存储
- [ ] **IndexedDB 存储**
  - 打开 DevTools → Application → IndexedDB
  - 找到 SpotItDB → images 表
  - 确认图片数据存在
  - 数据格式正确（dataUrl, mimeType, size, width, height）

- [ ] **刷新页面**
  - 上传图片后刷新页面（F5）
  - 图片仍然显示
  - 数据未丢失

#### 4.2 导入导出
- [ ] **导出数据**
  - 进入设置页面
  - 点击"导出数据"
  - 下载 JSON 文件
  - 打开 JSON 文件，确认包含 images 数组

- [ ] **导入数据**
  - 清空数据库
  - 导入之前导出的 JSON 文件
  - 图片正确恢复
  - 所有物品的图片都显示正常

---

### 5. 性能测试

#### 5.1 压缩性能
- [ ] **小文件（<1MB）**
  - 处理时间 <1秒
  - 压缩率 40-60%

- [ ] **中等文件（1-5MB）**
  - 处理时间 1-2秒
  - 压缩率 70-85%

- [ ] **大文件（5-10MB）**
  - 处理时间 2-3秒
  - 压缩率 85-95%

#### 5.2 列表性能
- [ ] **10个物品**
  - 列表加载流畅
  - 无明显卡顿

- [ ] **50个物品**
  - 列表加载时间 <2秒
  - 滚动流畅

- [ ] **100个物品**
  - 列表加载时间 <5秒
  - 滚动基本流畅

#### 5.3 内存使用
- [ ] **上传单张图片**
  - 内存峰值 <50MB
  - 上传完成后内存释放

- [ ] **连续上传10张图片**
  - 内存峰值 <100MB
  - 无内存泄漏

---

### 6. 兼容性测试

#### 6.1 桌面浏览器
- [ ] **Chrome/Edge**
  - 所有功能正常
  - 性能良好

- [ ] **Firefox**
  - 所有功能正常
  - 性能良好

- [ ] **Safari**
  - 所有功能正常
  - 性能良好

#### 6.2 移动浏览器
- [ ] **Chrome Mobile (Android)**
  - 相机调用正常
  - 相册选择正常
  - 触摸交互流畅

- [ ] **Safari iOS**
  - 相机调用正常
  - 相册选择正常
  - 触摸交互流畅

#### 6.3 不同屏幕尺寸
- [ ] **手机（375px）**
  - 布局正常
  - 按钮可点击

- [ ] **平板（768px）**
  - 布局正常
  - 图片显示合理

- [ ] **桌面（1920px）**
  - 布局正常
  - 最大宽度限制生效

---

### 7. 用户体验

#### 7.1 交互反馈
- [ ] **加载状态**
  - 上传时显示加载动画
  - 按钮禁用状态明确

- [ ] **成功反馈**
  - 上传成功后图片立即显示
  - 无需刷新页面

- [ ] **错误反馈**
  - 错误提示清晰明确
  - 错误提示位置合理
  - 错误提示颜色醒目

#### 7.2 视觉一致性
- [ ] **设计风格**
  - 与现有设计保持一致
  - 圆角、间距、颜色统一

- [ ] **图标使用**
  - 使用 lucide-react 图标
  - 图标大小一致
  - 图标语义清晰

#### 7.3 无障碍性
- [ ] **键盘导航**
  - Tab 键可以导航到所有按钮
  - Enter 键可以触发操作

- [ ] **屏幕阅读器**
  - 按钮有清晰的标签
  - 图片有 alt 属性
  - 错误提示可被读取

---

### 8. 边界情况

#### 8.1 极端情况
- [ ] **超大图片（>10MB）**
  - 显示错误提示
  - 不会崩溃

- [ ] **超高分辨率（8K）**
  - 自动压缩
  - 处理时间可接受

- [ ] **损坏的图片文件**
  - 显示错误提示
  - 不会崩溃

#### 8.2 并发操作
- [ ] **快速连续上传**
  - 只处理最后一次上传
  - 不会出现竞态条件

- [ ] **上传时删除**
  - 操作互斥
  - 数据一致性保证

#### 8.3 网络异常
- [ ] **断网情况**
  - 本地操作正常（查看、删除）
  - 上传操作显示错误

- [ ] **慢速网络**
  - 加载状态正确显示
  - 超时处理合理

---

## ✅ 验收标准

### 必须通过（P0）
- [ ] 所有基础上传功能正常
- [ ] 图片压缩到 ≤500KB
- [ ] 图片显示正常
- [ ] 数据持久化正常
- [ ] 无严重 Bug

### 应该通过（P1）
- [ ] 所有管理功能正常
- [ ] 性能指标达标
- [ ] 主流浏览器兼容
- [ ] 错误处理完善

### 可以优化（P2）
- [ ] 高级交互功能
- [ ] 极端情况处理
- [ ] 性能进一步优化

---

## 📊 验收结果

### 测试日期
- 开始：____年____月____日
- 完成：____年____月____日

### 测试人员
- 姓名：________________
- 角色：________________

### 测试环境
- 浏览器：________________
- 操作系统：________________
- 设备：________________

### 测试结果
- 通过项：____ / ____
- 失败项：____ / ____
- 阻塞项：____ / ____

### 问题列表
1. ________________
2. ________________
3. ________________

### 验收结论
- [ ] ✅ 通过验收，可以发布
- [ ] ⚠️ 有小问题，修复后发布
- [ ] ❌ 未通过验收，需要重大修改

### 签字确认
- 开发人员：________________ 日期：________
- 测试人员：________________ 日期：________
- 产品负责人：________________ 日期：________

---

## 📝 备注

### 测试建议
1. 建议在真实移动设备上测试
2. 建议测试不同网络环境
3. 建议测试不同图片格式和大小
4. 建议进行压力测试

### 已知限制
1. 每个物品仅支持 1 张图片
2. 图片存储在本地 IndexedDB
3. 不支持图片编辑功能
4. 不支持云端同步

### 后续优化
1. 添加图片裁剪功能
2. 支持多图片上传
3. 添加图片滤镜
4. 优化压缩算法
